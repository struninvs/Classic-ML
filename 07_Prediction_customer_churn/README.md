# Моделирование оттока клиентов
## Постановка задачи
Из «Бета-Банка» стали уходить клиенты. Каждый месяц. Немного, но заметно. Банковские маркетологи посчитали: сохранять текущих клиентов дешевле, чем привлекать новых.

Нужно спрогнозировать, уйдёт клиент из банка в ближайшее время или нет. Для проекта предоставлены исторические данные о поведении клиентов и расторжении договоров с банком. 

Задача: построить модель для решения задачи классификации с предельно большим значением *F1*-меры (минимум 0.59) и проверить *F1*-меру на тестовой выборке. Дополнительно измерять *AUC-ROC* для сравнения её значения с *F1*-мерой.

Источник данных: [https://www.kaggle.com/barelydedicated/bank-customer-churn-modeling](https://www.kaggle.com/barelydedicated/bank-customer-churn-modeling)
## Исходные данные
В нашем распоряжении исторические данные о поведении клиентов и расторжении договоров с банком. Данные находятся в файле `Churn.csv`, отдельной тестовой выборки нет, значит, исходные данные будет необходимо разбить на три части: обучающую, валидационную и тестовую.

**Признаки:**

* `RowNumber` — индекс строки в данных;
* `CustomerId` — уникальный идентификатор клиента;
* `Surname` — фамилия;
* `CreditScore` — кредитный рейтинг;
* `Geography` — страна проживания;
* `Gender` — пол;
* `Age` — возраст;
* `Tenure` — сколько лет человек является клиентом банка;
* `Balance` — баланс на счёте;
* `NumOfProducts` — количество продуктов банка, используемых клиентом;
* `HasCrCard` — наличие кредитной карты;
* `IsActiveMember` — активность клиента;
* `EstimatedSalary` — предполагаемая зарплата.

**Целевые признаки:**

* `Exited` — факт ухода клиента.

## Выводы
В рамках проекта, нам было необходимо решить задачу классификации - определить, уйдет клиент в ближайшее время или нет. Для выполнения этой задачи мы использовали алгоритмы логистической регрессии, решающего дерева и случайного леса. Для оценки моделей использовался показатель F1-меры (минимум 0.59 для успешной сдачи проекта), который объединяет две метрики - precision и recall, а также кривую ROC с указанием ее площади (ROC-AUC).

В ходе предварительной обработки данных мы проверили исходный набор данных на дубликаты и исключили некоторые признаки. Далее, на этапе разведочного анализа данных (EDA) было удалено 15.25% объектов: с аномальными значениями заработной платы в поле `estimated_salary`, с пропущенными данными в поле `tenure`, а также объектов с выбросами и редкими значениями по остальным столбцам.

В ходе подготовки данных для обучения модели:

* категориальные признаки конвертированы в числовые методом прямого кодирования;
* численные признаки приведены к одному масштабу методом стандартизации;
* выполнена разбивка данных на обучающую, валидационную и тестовую выборки в соотношении (3:1:1) с выделением целевого признака и сохранением баланса классов как в исходном наборе.

После этого модели сначала были обучены пробно, без учета дисбаланса классов и без подбора гиперпараметров, после этого обучены с учетом дисбаланса классов двумя способами:

* с параметром параметр `class_weight = 'balanced'` при создании моделей;
* с помощью ребалансировки классов в обучающей выборке.
Выбранные для оценки качества метрики после учета дисбаланса классов снизились по сравнению с метриками моделей обученных просто на сырых данных. Побробнее [тут](#Выводы-10.4). 

**На тестовой выборке модель с алгоритмом случайный лес (Random Forest) показала лучшие результаты: целевой показатель F1 (не менее 0.59) достигнут. Модель прошла проверку на адекватность и доказала свою состоятельность.**

Результаты исследования возможно улучшить, для этого необходимо уточнить:

1. вопросы по признаку `tenure`:
    * 9% данных поля `tenure` о том, сколько лет человек является клиентом банка **пропущены**;
    * установлено, что пропущенные данные поля `tenure` не принадлежат одной определенной стране;
    * основное предположение - данные утеряны или не были занесены, возможно их можно восстановить вручную.
2. вопросы по признаку `estimated_salary`:
    * 0.76% записей не соответствуют данным о минимальных заработных платах в Европейских странах;
    * нет данных о периоде за который указана заработная плата (в час, день, месяц и т.д.);
    * нет данных до или после вычета налогов указана заработная плата.

В заключение, буду рад поделиться интересными наблюдениями, которые появились в ходе анализа предоставленных данных:

* в Германии доля клиентов, которые ушли в два раза выше, чем во Франции и Испании;
* клиенты более старшего возраста отказываются от услуг банка чаще: действующие клиенты примерно на 10 лет младше тех, кто решил прекратить работу с банком;
* более состоятельные клиенты отказываются от услуг банка чаще: ушедшие клиенты хранили деньги на счетах чаще и в более крупных размерах;
* клиенты, которые пробуют использовать дополнительные, кроме самых распространенных продукты - уходят. Необходимо проанализировать ситуацию: возможно улучшить доп. услуги банка?
* женщины чаще мужчин принимают решение прекратить пользование услугами банка. Согласно [данным совместного исследования «Росгосстрах Жизнь» и банка «Открытие»](https://plus.rbc.ru/pressrelease/5d5d33c67a8aa965eb3fd65e#:~:text=Женщины%20покупают%20полисы%20страхования%20жизни,«Росгосстрах%20Жизнь»%20и%20банка%20«Открытие») - женщины покупают полисы страхования жизни чаще мужчин: на их долю приходится чуть более 60% договоров. Возможно это дополнительно подтверждает предыдущее наблюдение: отток клиентов среди женщин выше, потому что уровень дополнительных услуг страхования в банке ниже, чем у конкурентов.

Можно представить облик клиента, который, вероятно, с банком надолго и клиента, который вскоре уйдет. Первый - это скорее всего молодой человек 35 лет, без накоплений и часто пользуется кредитными продуктами (высокий кредитный рейтинг). Второй - более возрастные мужчины или женщины, имеющие накопления. 

Искренне надеюсь, что данные наблюдения смогут помочь скорректировать рекламную кампанию маркетологам и удержать клиентов.